# BaroDetector: 스마트워치를 이용한 건물 단위 위치 추적

한국통신학회논문지 게제 예정

## 연구 배경

우리는 일상생활에서 여러 위치 기반 서비스를 이용하며 살고 있다. 이러한 서비스는 일반적으로 GPS (Global Positioning System)를 사용한다. GPS는 실내와 같이 인공위성의 영향을 받기 어려운 곳은 신뢰도가 매우 낮다. 이러한 문제는 도시 환경에서 약 100m의 위치 오류를 일으킬 수 있다. GPS 센서는 소모 전력량이 매우 많은 센서이기도 하다. GPS 센서는 사용자의 위치를 특정하기 어려운 환경에서 정확한 위치 정보를 얻고자 지속적으로 위성 스캔을 시도한다. 이로 인해 지도상의 위치가 계속해서 바뀌어 사용자의 정확한 위치를 특정하는 데 혼동을 주며, 배터리 소모도 그만큼 증가한다.

위치 기반 서비스의 또 다른 영역으로는 실내/외 감지 기능이 있다. 실내/외 감지는 사용자 상태를 실내 또는 실외로 구분하는 것이다. 기존의 연구 앞서 언급한 GPS의 단점을 보완하기 위해 스마트폰에 내장된 여러 센서 조합을 사용하여 실내/외 감지 문제를 해결하려고 시도했다. 하지만 이러한 연구를 실제 (in-the-wild) 환경에 적용하기 위해서는 일정한 환경을 유지해야하는 문제가 있다. 스마트워치의 경우, 대부분의 시간 동안 사용자의 손목 위에 위치한다. 이 점은 스마트워치가 사용자의 주변 환경을 대표하는 가장 적절한 기기임을 의미한다.

우리는 압력 센서가 실내/외 감지 기술을 구현하는 데 중요한 역할을 할 수 있을 것으로 생각한다. 건물 대부분은 쾌적한 실내 온도 및 압력을 유지하기 위해 HVAC (Heating, ventilating and air conditioning) 시스템을 갖추고 있다. 이로 인해 건물 내부와 외부 사이에 환경적인 차이를 만든다. 이러한 차이로 인해 출입문을 통과할 때, 통상적으로 10Pa에서 30Pa의 기압 변화를 감지할 수 있다. 또한, 일정한 수준의 기압을 유지하다가 출입문을 통과할 때 우하향 혹은 우상향 후 다시 일정 수준의 기압을 유지하는 패턴을 관찰할 수 있다. 또한, 압력 센서는 센서가 활성화된 상황에서 110mW의 전력을 소모해 GPS 센서에 비해 전력량 소모가 적어 스마트워치를 이용한 기술에 사용하기 적절하다. 

실내/외 감지 기술을 구현하는 데 있어 GPS 원시 데이터 내 가시 위성의 숫자도 중요한 역할을 할 수 있다. Statista에 따르면, 2021년 1월 기준 지구의 위성군 (Satellite Constellation)에는 3372개의 활성 위성이 있다. Kongyang Chen 등은 실험을 통해 가시 위성의 수가 실내/외 상태와 강한 상관관계가 있음을 보였다.

본 연구에서는 스마트워치의 기압 센서 및 스마트폰 내 GPS 원시 데이터인 가시 위성의 수를 이용해 건물 단위의 위치 추적을 구현하고자 하였다.

## 데이터 수집

### 데이터 수집 에이전트 (Android/Tizen)


![Data collection agents](https://user-images.githubusercontent.com/88572107/139855303-18566ec3-2822-410b-bb1e-5075f6c6dbdf.png)



Android 에이전트: 버튼을 통해 기압 데이터를 수집한 위치에 대한 GT 수집 역할

Tizen 에이전트: 내장된 압력센서를 이용하여 기압 데이터 수집 및 Android 에이전트로 데이터 파일 송신

* Android 에이전트에 나온대로 데이터를 수집하는 장소에 따라, Indoor, passing, Outdoor로 나누어 Labeling 함.

## 데이터 전처리

### Sliding window + Moving avrage filter

출입문을 열고, 통과하고, 닫는 일련의 과정이 3초 안에 이루어지기에 3초의 슬라이딩 윈도를 적용함

Outlier가 많은 stream data를 smoothing하기 위해 Moving average filter 적용

![Barometer sensor stream data](https://user-images.githubusercontent.com/88572107/140635081-b00535d3-5109-413b-9c2e-23e3c774c7f3.PNG)

### Min-max normalization

기계학습을 위해 scaling이 필요

다양한 환경에서 수집한 데이터들을 0~1 사이의 값으로 만듦

## Feature extraction

Feature들이 나오게 된 배경 (유비컴 페이퍼/다른 페이퍼들 목록)

결과적으로 어떤 feature들을 썼는지, 이에 대한 상관성은 얼마나 나왔는지

(웨카 피처별 상관성 그림)

## GPS 가시 위성

밖에서 받는다는 가정 하지말고, 평균값에서 엄청 바뀌었는데 숫자 비교해보니 크다 -> 안에서 밖으로 나간거
반대다 밖에서 안으로 들어간거 이렇게 해야 논리적이다

큐를 만들고, 20개의 값을 받아 평균값을 냄. 평균값에서 50% 이상 값이 차이날 경우 사용자의 위치에 변화가 있었다는 뜻
실내에서 작동이 시작된 것도 고려

## Optimization

### 처음 수행 결과 --> 51%

### 피처를 바꾸고, binary selection으로 만든 후 나온 결과 97%

웨카 결과 업로드

#### False positive

높은 false positive rate (18%), 이를 극복하기위한 방안

기압 데이터는 사용자가 실내에 진입한 시간이 지남에 따라 더 확실한 변화를 보인다는 점에 착안해 슬라이딩 윈도우 길이를 조절


## 데이터 분석 개념 정리

#### Precision

#### Recall

